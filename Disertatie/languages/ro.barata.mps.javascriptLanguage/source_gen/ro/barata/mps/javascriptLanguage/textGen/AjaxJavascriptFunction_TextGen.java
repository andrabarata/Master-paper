package ro.barata.mps.javascriptLanguage.textGen;

/*Generated by MPS */

import jetbrains.mps.textGen.SNodeTextGen;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class AjaxJavascriptFunction_TextGen extends SNodeTextGen {
  public void doGenerateText(SNode node) {
    this.append("function ");
    this.append(SPropertyOperations.getString(node, MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name")));
    this.append("(pageName,actionName,names,values,refreshFunction){");
    this.appendNewLine();
    this.append("var ajaxRequest;");
    this.appendNewLine();
    this.append("try{");
    this.appendNewLine();
    this.append("ajaxRequest = new XMLHttpRequest();");
    this.appendNewLine();
    this.append("} catch (e){");
    this.appendNewLine();
    this.append("try{");
    this.appendNewLine();
    this.append("ajaxRequest = new ActiveXObject(\"Msxml2.XMLHTTP\");");
    this.appendNewLine();
    this.append("} catch (e) {");
    this.appendNewLine();
    this.append("try{");
    this.appendNewLine();
    this.append("ajaxRequest = new ActiveXObject(\"Microsoft.XMLHTTP\");");
    this.appendNewLine();
    this.append("} catch (e){");
    this.appendNewLine();
    this.append("alert(\"error\");");
    this.appendNewLine();
    this.append("return false;");
    this.appendNewLine();
    this.append("}");
    this.appendNewLine();
    this.append("}");
    this.appendNewLine();
    this.append("}");
    this.append("ajaxRequest.onreadystatechange = function(){");
    this.appendNewLine();
    this.append("if(ajaxRequest.readyState == 4){");
    this.appendNewLine();
    this.append("if (typeof refreshFunction!=\"undefined\"){");
    this.appendNewLine();
    this.append("var jsonObj = JSON.parse(ajaxRequest.responseText);");
    this.appendNewLine();
    this.append("refreshFunction(jsonObj);}");
    this.append("else");
    this.appendNewLine();
    this.append("document.documentElement.innerHTML = ajaxRequest.responseText;");
    this.appendNewLine();
    this.append("}");
    this.appendNewLine();
    this.append("};");
    this.appendNewLine();
    this.append("var queryString=\"?actionName=\"+actionName;");
    this.appendNewLine();
    this.append("var params = \"\";");
    this.appendNewLine();
    this.append("for (var i=0;i<names.length;i++)");
    this.appendNewLine();
    this.append("queryString+=\"&\"+names[i]+\"=\"+values[i];");
    this.appendNewLine();
    this.append("ajaxRequest.open(\"POST\", pageName + queryString, true);");
    this.appendNewLine();
    this.append("ajaxRequest.send(null);");
    this.appendNewLine();
    this.append("}");
  }
}
