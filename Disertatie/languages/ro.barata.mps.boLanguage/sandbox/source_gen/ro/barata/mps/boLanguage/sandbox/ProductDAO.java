package ro.barata.mps.boLanguage.sandbox;

/*Generated by MPS */

import java.sql.Connection;
import java.sql.Statement;
import java.sql.SQLException;
import java.util.List;
import java.util.ArrayList;
import java.sql.ResultSet;
import java.util.LinkedList;

public class ProductDAO {
  private Connection connn;
  private Statement stmt;

  public ProductDAO(Connection connection) throws SQLException, ClassNotFoundException {
    connn = connection;
    stmt = connection.createStatement();
  }

  public List<Product> getAllProducts() throws SQLException {
    List<Product> products = new ArrayList<Product>();
    String columns = "";
    columns += "table0." + "id" + " \"parent" + "id" + "\",";
    columns += "table0." + "name" + " \"parent" + "name" + "\",";
    columns += "table0." + "price" + " \"parent" + "price" + "\",";
    columns += "table0." + "description" + " \"parent" + "description" + "\",";
    String sql = " from " + "Product" + " table0";
    String leftJoins = "";
    int i = 1;
    columns += "table" + i + "." + "id" + " \"" + "Attribute" + "id" + "\",";
    columns += "table" + i + "." + "name" + " \"" + "Attribute" + "name" + "\",";
    columns += "table" + i + "." + "value" + " \"" + "Attribute" + "value" + "\",";
    leftJoins += " left join " + "Attribute" + " table" + i + " on table" + i + "." + "productId" + "=table0." + "id" + " ";
    i++;

    sql = "select " + columns.substring(0, columns.length() - 1) + sql + leftJoins;
    System.out.println(sql);
    ResultSet set = stmt.executeQuery(sql);
    Product foundProduct = null;
    while (set.next()) {
      foundProduct = new Product();
      foundProduct.setId(Integer.valueOf(set.getBigDecimal("parent" + "id").intValue()));
      foundProduct.setProductName(set.getString("parent" + "name"));
      foundProduct.setPrice(Integer.valueOf(set.getBigDecimal("parent" + "price").intValue()));
      foundProduct.setDescription(set.getString("parent" + "description"));
      {
        Attribute child = new Attribute();
        if (set.getBigDecimal("Attribute" + "id") != null) {
          child.setId(Integer.valueOf(set.getBigDecimal("Attribute" + "id").intValue()));
        }
        if (set.getString("Attribute" + "name") != null) {
          child.setAttributeName(set.getString("Attribute" + "name"));
        }
        if (set.getString("Attribute" + "value") != null) {
          child.setAttributeValue(set.getString("Attribute" + "value"));
        }
        if (child.getId() != null) {
          foundProduct.addAttribute(child);
        }
      }
      boolean flag = true;
      for (Product entity : products) {
        if (entity.getId() == foundProduct.getId()) {
          flag = false;
        }
      }
      if (flag) {
        products.add(foundProduct);
      }
    }
    return products;
  }

  public List<Product> findProducts(Product product) throws SQLException {
    List<Product> products = new ArrayList<Product>();
    String sql = "select ";
    String columns = "";
    columns += "id";
    columns += ",";
    columns += "name";
    columns += ",";
    columns += "price";
    columns += ",";
    columns += "description";
    String values = "";
    if (product.getId() != null) {
      values += "id" + "='" + product.getId() + "' and ";
    }
    if (product.getProductName() != null) {
      values += "name" + "='" + product.getProductName() + "' and ";
    }
    if (product.getPrice() != null) {
      values += "price" + "='" + product.getPrice() + "' and ";
    }
    if (product.getDescription() != null) {
      values += "description" + "='" + product.getDescription() + "' and ";
    }
    int i = 1;
    if (values.length() > 6) {
      values = " where " + values.substring(0, values.length() - 5);
    }
    sql += columns + " from " + "Product" + values;
    System.out.println("Find entities: " + sql);
    ResultSet set = stmt.executeQuery(sql);
    Product foundProduct = new Product();
    while (set.next()) {
      foundProduct = new Product();
      foundProduct.setId(Integer.valueOf(set.getBigDecimal("id").intValue()));
      foundProduct.setProductName(set.getString("name"));
      foundProduct.setPrice(Integer.valueOf(set.getBigDecimal("price").intValue()));
      foundProduct.setDescription(set.getString("description"));
      products.add(foundProduct);
    }
    return products;
  }
  public List<Attribute> findChildAttributes(Product parent) throws SQLException {
    List<Attribute> attributes = new ArrayList<Attribute>();
    String sql = "select ";
    String columns = "";
    columns += "id";
    columns += ",";
    columns += "name";
    columns += ",";
    columns += "value";
    sql += columns;
    sql += " from " + "Attribute" + " where " + "productId" + " in (select " + "id" + " from " + "Product";
    if (parent != null) {
      sql += " where ";
      String values = "";
      if (parent.getId() != null) {
        values += "id" + "='" + parent.getId() + "'and ";
      }
      if (parent.getProductName() != null) {
        values += "name" + "='" + parent.getProductName() + "'and ";
      }
      if (parent.getPrice() != null) {
        values += "price" + "='" + parent.getPrice() + "'and ";
      }
      if (parent.getDescription() != null) {
        values += "description" + "='" + parent.getDescription() + "'and ";
      }
      sql += values.substring(0, values.length() - 4);
    }
    sql += ")";
    System.out.println(sql);
    ResultSet set = stmt.executeQuery(sql);
    Attribute foundAttribute = new Attribute();
    while (set.next()) {
      foundAttribute = new Attribute();
      foundAttribute.setId(Integer.valueOf(set.getBigDecimal("id").intValue()));
      foundAttribute.setAttributeName(set.getString("name"));
      foundAttribute.setAttributeValue(set.getString("value"));
      attributes.add(foundAttribute);
    }
    return attributes;
  }

  public void addProduct(Product product) throws SQLException, ClassNotFoundException {
    String sql = "insert into " + "Product" + "(";
    String columns = "";
    String values = "";
    if (product.getId() != null) {
      columns += "id" + ",";
      values += "'" + product.getId() + "',";
    }
    if (product.getProductName() != null) {
      columns += "name" + ",";
      values += "'" + product.getProductName() + "',";
    }
    if (product.getPrice() != null) {
      columns += "price" + ",";
      values += "'" + product.getPrice() + "',";
    }
    if (product.getDescription() != null) {
      columns += "description" + ",";
      values += "'" + product.getDescription() + "',";
    }
    {
      Category parentCategory = product.getParentCategory();
      if (parentCategory != null) {
        columns += "categoryId" + ",";
        values += "'" + parentCategory.getId().toString() + "',";
      }
    }
    sql += columns.substring(0, columns.length() - 1) + ") values (" + values.substring(0, values.length() - 1) + ")";
    System.out.println(sql);
    stmt.execute(sql);
    if (product.getAttributes() != null) {
      AttributeDAO childAttributeDAO = new AttributeDAO(connn);
      for (Attribute childAttribute : product.getAttributes()) {
        childAttributeDAO.addAttribute(childAttribute);
      }
    }
  }

  public void updateProduct(Product oldproduct, Product newproduct) throws SQLException, ClassNotFoundException {
    String sql = "update " + "Product" + " set ";
    String values = "";
    if (newproduct.getId() != null) {
      values += "id" + "='" + newproduct.getId() + "',";
    }
    if (newproduct.getProductName() != null) {
      values += "name" + "='" + newproduct.getProductName() + "',";
    }
    if (newproduct.getPrice() != null) {
      values += "price" + "='" + newproduct.getPrice() + "',";
    }
    if (newproduct.getDescription() != null) {
      values += "description" + "='" + newproduct.getDescription() + "',";
    }
    {
      List<String> columnsList = new LinkedList<String>();
      List<String> valuesList = new LinkedList<String>();
      {
        Category parentCategory = newproduct.getParentCategory();
        if (parentCategory != null) {
          columnsList.add("categoryId");
          valuesList.add(parentCategory.getId().toString());
        }
      }
      for (int i = 0; i < columnsList.size(); i++) {
        values += columnsList.get(i) + "='" + valuesList.get(i) + "',";
      }
    }
    String condition = " where ";
    if (oldproduct.getId() != null) {
      condition += "id" + "='" + oldproduct.getId() + "' and ";
    }
    if (oldproduct.getProductName() != null) {
      condition += "name" + "='" + oldproduct.getProductName() + "' and ";
    }
    if (oldproduct.getPrice() != null) {
      condition += "price" + "='" + oldproduct.getPrice() + "' and ";
    }
    if (oldproduct.getDescription() != null) {
      condition += "description" + "='" + oldproduct.getDescription() + "' and ";
    }
    sql += values.substring(0, values.length() - 1) + condition.substring(0, condition.length() - 4);
    System.out.println(sql);
    stmt.execute(sql);
    if (newproduct.getAttributes() != null) {
      AttributeDAO childAttributeDAO = new AttributeDAO(connn);
      for (Attribute childAttribute : newproduct.getAttributes()) {
        childAttributeDAO.addAttribute(childAttribute);
      }
    }

  }

  public void deleteProduct(Product product) throws SQLException {
    String sql = "delete from " + "Product" + " where";
    String condition = " ";
    if (product.getId() != null) {
      condition += "id" + "='" + product.getId() + "'";
      condition += " and ";
    }
    if (product.getProductName() != null) {
      condition += "name" + "='" + product.getProductName() + "'";
      condition += " and ";
    }
    if (product.getPrice() != null) {
      condition += "price" + "='" + product.getPrice() + "'";
      condition += " and ";
    }
    if (product.getDescription() != null) {
      condition += "description" + "='" + product.getDescription() + "'";
      condition += " and ";
    }
    sql += condition.substring(0, condition.length() - 5);
    System.out.println(sql);
    stmt.execute(sql);

  }

}
