package ro.barata.mps.boLanguage.sandbox;

/*Generated by MPS */

import java.sql.Statement;
import java.sql.SQLException;

public class SchemaCreator {

  private static void generateTables(Statement stmt) throws SQLException, ClassNotFoundException {
    String sql = "";
    String primaryKey = "";

    primaryKey = "";
    primaryKey = "primary key(";
    primaryKey += "id";
    primaryKey += ")";
    sql = "create table " + "Shop" + "(";
    sql += "id" + " " + "integer" + ",";
    sql += "name" + " " + "varchar(256)" + ",";
    if (primaryKey.length() == 0) {
      sql = sql.substring(0, sql.length() - 1);
    }
    sql += primaryKey;
    sql += ")";
    System.out.println(sql);
    stmt.execute(sql);

    primaryKey = "";
    primaryKey = "primary key(";
    primaryKey += "id";
    primaryKey += ")";
    sql = "create table " + "Category" + "(";
    sql += "id" + " " + "integer" + ",";
    sql += "name" + " " + "varchar(256)" + ",";
    sql += "shopId" + " " + "integer" + ",";
    sql += "subCategoryId" + " " + "integer" + ",";
    if (primaryKey.length() == 0) {
      sql = sql.substring(0, sql.length() - 1);
    }
    sql += primaryKey;
    sql += ")";
    System.out.println(sql);
    stmt.execute(sql);

    primaryKey = "";
    primaryKey = "primary key(";
    primaryKey += "id";
    primaryKey += ")";
    sql = "create table " + "Product" + "(";
    sql += "id" + " " + "integer" + ",";
    sql += "name" + " " + "varchar(256)" + ",";
    sql += "categoryId" + " " + "integer" + ",";
    if (primaryKey.length() == 0) {
      sql = sql.substring(0, sql.length() - 1);
    }
    sql += primaryKey;
    sql += ")";
    System.out.println(sql);
    stmt.execute(sql);

    primaryKey = "";
    primaryKey = "primary key(";
    primaryKey += "id";
    primaryKey += ")";
    sql = "create table " + "Attribute" + "(";
    sql += "id" + " " + "integer" + ",";
    sql += "name" + " " + "varchar(256)" + ",";
    sql += "value" + " " + "varchar(256)" + ",";
    sql += "productId" + " " + "integer" + ",";
    if (primaryKey.length() == 0) {
      sql = sql.substring(0, sql.length() - 1);
    }
    sql += primaryKey;
    sql += ")";
    System.out.println(sql);
    stmt.execute(sql);

    primaryKey = "";
    primaryKey = "primary key(";
    primaryKey += "id";
    primaryKey += ")";
    sql = "create table " + "Customer" + "(";
    sql += "id" + " " + "integer" + ",";
    sql += "personId" + " " + "integer" + ",";
    sql += "shopId" + " " + "integer" + ",";
    if (primaryKey.length() == 0) {
      sql = sql.substring(0, sql.length() - 1);
    }
    sql += primaryKey;
    sql += ")";
    System.out.println(sql);
    stmt.execute(sql);

    primaryKey = "";
    primaryKey = "primary key(";
    primaryKey += "id";
    primaryKey += ")";
    sql = "create table " + "Person" + "(";
    sql += "id" + " " + "integer" + ",";
    sql += "firstName" + " " + "varchar(256)" + ",";
    sql += "lastName" + " " + "varchar(256)" + ",";
    if (primaryKey.length() == 0) {
      sql = sql.substring(0, sql.length() - 1);
    }
    sql += primaryKey;
    sql += ")";
    System.out.println(sql);
    stmt.execute(sql);

  }
  private static void constrainTables(Statement stmt) throws SQLException, ClassNotFoundException {
    String sql = "";

    sql = "alter table " + "Category" + " add constraint fk_" + "Category" + "_" + "shopId";
    sql += " foreign key (" + "shopId" + ") references " + "Shop" + "(" + "id" + ")";
    System.out.println(sql);
    stmt.execute(sql);

    sql = "alter table " + "Category" + " add constraint fk_" + "Category" + "_" + "subCategoryId";
    sql += " foreign key (" + "subCategoryId" + ") references " + "Category" + "(" + "id" + ")";
    System.out.println(sql);
    stmt.execute(sql);

    sql = "alter table " + "Product" + " add constraint fk_" + "Product" + "_" + "categoryId";
    sql += " foreign key (" + "categoryId" + ") references " + "Category" + "(" + "id" + ")";
    System.out.println(sql);
    stmt.execute(sql);

    sql = "alter table " + "Attribute" + " add constraint fk_" + "Attribute" + "_" + "productId";
    sql += " foreign key (" + "productId" + ") references " + "Product" + "(" + "id" + ")";
    System.out.println(sql);
    stmt.execute(sql);

    sql = "alter table " + "Customer" + " add constraint fk_" + "Customer" + "_" + "personId";
    sql += " foreign key (" + "personId" + ") references " + "Person" + "(" + "id" + ")";
    System.out.println(sql);
    stmt.execute(sql);
    sql = "alter table " + "Customer" + " add constraint fk_" + "Customer" + "_" + "shopId";
    sql += " foreign key (" + "shopId" + ") references " + "Shop" + "(" + "id" + ")";
    System.out.println(sql);
    stmt.execute(sql);

  }

  private static void dropTables(Statement stmt) throws ClassNotFoundException, SQLException {
    String sql = "";
    sql = "drop table " + "Shop" + " cascade constraints";
    stmt.executeUpdate(sql);

    sql = "drop table " + "Category" + " cascade constraints";
    stmt.executeUpdate(sql);

    sql = "drop table " + "Product" + " cascade constraints";
    stmt.executeUpdate(sql);

    sql = "drop table " + "Attribute" + " cascade constraints";
    stmt.executeUpdate(sql);

    sql = "drop table " + "Customer" + " cascade constraints";
    stmt.executeUpdate(sql);

    sql = "drop table " + "Person" + " cascade constraints";
    stmt.executeUpdate(sql);

  }

  public static void main(String[] args) throws ClassNotFoundException, SQLException {
    Statement stmt = DatabaseConnection.getConnection().createStatement();

    try {
      generateTables(stmt);
      constrainTables(stmt);
    } catch (Exception e) {
      e.printStackTrace();
    }
    stmt.close();

  }



}
