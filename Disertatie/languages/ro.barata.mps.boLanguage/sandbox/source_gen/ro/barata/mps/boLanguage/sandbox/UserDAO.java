package ro.barata.mps.boLanguage.sandbox;

/*Generated by MPS */

import java.sql.Connection;
import java.sql.Statement;
import java.sql.SQLException;
import java.util.List;
import java.util.ArrayList;
import java.sql.ResultSet;
import java.util.LinkedList;

public class UserDAO {
  private Connection connn;
  private Statement stmt;

  public UserDAO(Connection connection) throws SQLException, ClassNotFoundException {
    connn = connection;
    stmt = connection.createStatement();
  }

  public List<User> getAllUsers() throws SQLException {
    List<User> users = new ArrayList<User>();
    String sql = "select * from " + "UserTable" + " table0";
    String innerJoins = "";
    int i = 1;
    sql += innerJoins;
    System.out.println(sql);
    ResultSet set = stmt.executeQuery(sql);
    User foundUser = new User();
    while (set.next()) {
      foundUser = new User();
      foundUser.setUserId(Integer.valueOf(set.getBigDecimal("id").intValue()));
      foundUser.setPriviledge(set.getString("priviledge"));
      foundUser.setUserName(set.getString("userName"));
      foundUser.setPassword(set.getString("password"));
      users.add(foundUser);
    }
    return users;
  }

  public List<User> findUsers(User user) throws SQLException {
    List<User> users = new ArrayList<User>();
    String sql = "select ";
    String columns = "";
    columns += "id";
    columns += ",";
    columns += "priviledge";
    columns += ",";
    columns += "userName";
    columns += ",";
    columns += "password";
    String values = "";
    if (user.getUserId() != null) {
      values += "id" + "='" + user.getUserId() + "' and ";
    }
    if (user.getPriviledge() != null) {
      values += "priviledge" + "='" + user.getPriviledge() + "' and ";
    }
    if (user.getUserName() != null) {
      values += "userName" + "='" + user.getUserName() + "' and ";
    }
    if (user.getPassword() != null) {
      values += "password" + "='" + user.getPassword() + "' and ";
    }
    String leftJoins = "";
    int i = 1;
    if (values.length() > 6) {
      values = " where " + values.substring(0, values.length() - 5);
    }
    sql += columns + " from " + "UserTable" + " table0" + leftJoins + values;
    System.out.println(sql);
    ResultSet set = stmt.executeQuery(sql);
    User foundUser = new User();
    while (set.next()) {
      foundUser = new User();
      foundUser.setUserId(Integer.valueOf(set.getBigDecimal("id").intValue()));
      foundUser.setPriviledge(set.getString("priviledge"));
      foundUser.setUserName(set.getString("userName"));
      foundUser.setPassword(set.getString("password"));
      users.add(foundUser);
    }
    return users;
  }

  public void addUser(User user) throws SQLException, ClassNotFoundException {
    String sql = "insert into " + "UserTable" + "(";
    String columns = "";
    String values = "";
    if (user.getUserId() != null) {
      columns += "id" + ",";
      values += "'" + user.getUserId() + "',";
    }
    if (user.getPriviledge() != null) {
      columns += "priviledge" + ",";
      values += "'" + user.getPriviledge() + "',";
    }
    if (user.getUserName() != null) {
      columns += "userName" + ",";
      values += "'" + user.getUserName() + "',";
    }
    if (user.getPassword() != null) {
      columns += "password" + ",";
      values += "'" + user.getPassword() + "',";
    }
    {
      Shop parentShop = user.getParentShop();
      if (parentShop != null) {
        columns += "shopId" + ",";
        values += "'" + parentShop.getId().toString() + "',";
      }
    }
    if (user.getPerson() != null) {
      Person referencePerson = user.getPerson();
      PersonDAO referencePersonDAO = new PersonDAO(connn);
      referencePersonDAO.addPerson(referencePerson);
      columns += "personId" + ",";
      values += "'" + referencePerson.getId() + "',";
    }
    sql += columns.substring(0, columns.length() - 1) + ") values (" + values.substring(0, values.length() - 1) + ")";
    System.out.println(sql);
    stmt.execute(sql);
  }

  public void updateUser(User olduser, User newuser) throws SQLException, ClassNotFoundException {
    String sql = "update " + "UserTable" + " set ";
    String values = "";
    if (newuser.getUserId() != null) {
      values += "id" + "='" + newuser.getUserId() + "',";
    }
    if (newuser.getPriviledge() != null) {
      values += "priviledge" + "='" + newuser.getPriviledge() + "',";
    }
    if (newuser.getUserName() != null) {
      values += "userName" + "='" + newuser.getUserName() + "',";
    }
    if (newuser.getPassword() != null) {
      values += "password" + "='" + newuser.getPassword() + "',";
    }
    {
      List<String> columnsList = new LinkedList<String>();
      List<String> valuesList = new LinkedList<String>();
      {
        Shop parentShop = newuser.getParentShop();
        if (parentShop != null) {
          columnsList.add("shopId");
          valuesList.add(parentShop.getId().toString());
        }
      }
      for (int i = 0; i < columnsList.size(); i++) {
        values += columnsList.get(i) + "='" + valuesList.get(i) + "',";
      }
    }
    if (newuser.getPerson() != null) {
      Person referencePerson = newuser.getPerson();
      PersonDAO referencePersonDAO = new PersonDAO(connn);
      referencePersonDAO.addPerson(referencePerson);
      values += "personId" + "=" + "'" + referencePerson.getId() + "'";
    }
    String condition = " where ";
    if (olduser.getUserId() != null) {
      condition += "id" + "='" + olduser.getUserId() + "' and ";
    }
    if (olduser.getPriviledge() != null) {
      condition += "priviledge" + "='" + olduser.getPriviledge() + "' and ";
    }
    if (olduser.getUserName() != null) {
      condition += "userName" + "='" + olduser.getUserName() + "' and ";
    }
    if (olduser.getPassword() != null) {
      condition += "password" + "='" + olduser.getPassword() + "' and ";
    }
    sql += values.substring(0, values.length() - 1) + condition.substring(0, condition.length() - 4);
    System.out.println(sql);
    stmt.execute(sql);

  }

  public void deleteUser(User user) throws SQLException {
    String sql = "delete from " + "UserTable" + " where";
    String condition = " ";
    if (user.getUserId() != null) {
      condition += "id" + "='" + user.getUserId() + "'";
      condition += " and ";
    }
    if (user.getPriviledge() != null) {
      condition += "priviledge" + "='" + user.getPriviledge() + "'";
      condition += " and ";
    }
    if (user.getUserName() != null) {
      condition += "userName" + "='" + user.getUserName() + "'";
      condition += " and ";
    }
    if (user.getPassword() != null) {
      condition += "password" + "='" + user.getPassword() + "'";
      condition += " and ";
    }
    sql += condition.substring(0, condition.length() - 5);
    System.out.println(sql);
    stmt.execute(sql);

  }

}
